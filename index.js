'use strict';

let path = require('path')
const zlib = require('zlib')
let ElasticTractor = require(path.join(__dirname, '.', 'elastictractor.js'))

console.log('Loading function');

exports.handler = function(event, context, callback) {
    let tractor = new ElasticTractor();
    // If it has records
    if (event.Records) {
      _.forEach(event.Records, function(evtRecord) {
        var evtSrc = evtRecord.eventSource;
        if (evtRecord.EventSource) {
          evtSrc = evtRecord.EventSource;
        }
        switch(evtSrc) {
          case "aws:s3":
            tractor.processS3(evtRecord).then(results => {
              callback(null, "Success");
            }).catch(err => {
              console.log(`Occurred an error "${JSON.stringify(err)}" on event ${JSON.stringify(evtRecord)}`)
              callback(null, "Success");
            });
            break;
          case "aws:sns":
            tractor.processSNS(evtRecord).then(results => {
              callback(null, "Success");
            }).catch(err => {
              console.log(`Occurred an error "${JSON.stringify(err)}" on event ${JSON.stringify(evtRecord)}`)
              callback(err, "Error");
            });
            break;
          case "aws:kinesis":
            tractor.processKinesis(evtRecord).then(results => {
              callback(null, "Success");
            }).catch(err => {
              console.log(`Occurred an error "${JSON.stringify(err)}" on event ${JSON.stringify(evtRecord)}`)
              callback(err, "Error");
            });
            break;
          default:
            console.log(`Event source "${evtRecord.eventSource}" is not supported. Event: ${JSON.stringify(evtRecord)}`)
            callback(null, "Success");
        }
      })
    } else {
      // Treat as a stream of CloudWatch Logs
      var buffer = Buffer.from(event.awslogs.data, 'base64')
      zlib.unzip(buffer, (err, buffer) => {
        if (!err) {
          tractor.processAwsLog(JSON.parse(buffer.toString())).then(results => {
            callback(null, "Success");
          }).catch(err => {
            console.log(`Occurred an error "${JSON.stringify(err)}" on aws-logs ${buffer.toString()}`)
            callback(null, "Success");
          });
        } else {
          console.log(`Occurred an error "${JSON.stringify(err)}" on aws-logs ${buffer.toString()}`)
          callback(null, "Success");
        }
      });
    }
};

// exports.handler({
// 	"awslogs": {
//     "data": "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"
//   }
// })

// exports.handler({
//     "Records": [
//         {
//             "kinesis": {
//                 "kinesisSchemaVersion": "1.0",
//                 "partitionKey": "bluemix-nodered",
//                 "sequenceNumber": "49580831982549757066933184131143068709215562117733679154",
//                 "data": "eyJEYXRhIjoicmVxdWVzdC1tZXRyaWNzLWpzXHR7XCJ1cmlcIjpcIi92Mi42L21lL21lc3NhZ2VzP2FjY2Vzc190b2tlbj1FQUFKekdaQThoMEtJQkFDVUVSeFhtcWs5R2tJRWtGZVF5dFlaQVpBZ0FBMWZaQk1YNmVzOEs5UVJWSG04Um1kTVNBd0t0NUVKSWlUc1FJUmxCRzRqSFRXMXA0VXNMSVNNOTF0OTBCQ3dqdERaQUpjM3JpNVdTc2ZGWkFaQnRUMWZ5TWZzdmYzOUxqMGFqZGk2Z2wwMGxaQWY5blRuNElpNEdxdlAzSTMyTGFDckpBWkRaRFwiLFwiZHVyYXRpb25cIjoyNDEsXCJoYXNFcnJvclwiOnRydWUsXCJyZXF1ZXN0XCI6e1wiaGVhZGVyc1wiOntcImFjY2VwdFwiOlwiYXBwbGljYXRpb24vanNvblwiLFwiY29udGVudC10eXBlXCI6XCJhcHBsaWNhdGlvbi9qc29uXCIsXCJjb250ZW50LWxlbmd0aFwiOjY3fSxcImJvZHlcIjpcIntcXFwicmVjaXBpZW50XFxcIjp7XFxcImlkXFxcIjpcXFwiMzgzODI1Mjg0Mjg4MTk2MFxcXCJ9LFxcXCJzZW5kZXJfYWN0aW9uXFxcIjpcXFwidHlwaW5nX29uXFxcIn1cIn0sXCJyZXNwb25zZUZhdWx0XCI6e1wiaGVhZGVyc1wiOntcIngtcGFnZS11c2FnZVwiOlwie1xcXCJjYWxsX2NvdW50XFxcIjoxLFxcXCJ0b3RhbF9jcHV0aW1lXFxcIjoxLFxcXCJ0b3RhbF90aW1lXFxcIjoxfVwiLFwiYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luXCI6XCIqXCIsXCJzdHJpY3QtdHJhbnNwb3J0LXNlY3VyaXR5XCI6XCJtYXgtYWdlPTE1NTUyMDAwOyBwcmVsb2FkXCIsXCJ4LWZiLXRyYWNlLWlkXCI6XCJINkh6OVJQcXhTQlwiLFwieC1mYi1yZXZcIjpcIjM1NzgxNzVcIixcImNvbnRlbnQtdHlwZVwiOlwiYXBwbGljYXRpb24vanNvblwiLFwiZmFjZWJvb2stYXBpLXZlcnNpb25cIjpcInYyLjEwXCIsXCJjYWNoZS1jb250cm9sXCI6XCJuby1zdG9yZVwiLFwicHJhZ21hXCI6XCJuby1jYWNoZVwiLFwiZXhwaXJlc1wiOlwiU2F0LCAwMSBKYW4gMjAwMCAwMDowMDowMCBHTVRcIixcInd3dy1hdXRoZW50aWNhdGVcIjpcIk9BdXRoIFxcXCJGYWNlYm9vayBQbGF0Zm9ybVxcXCIgXFxcImludmFsaWRfcmVxdWVzdFxcXCIgXFxcIigjMTAwKSBObyBtYXRjaGluZyB1c2VyIGZvdW5kXFxcIlwiLFwieC1mYi1kZWJ1Z1wiOlwiZU96bC9GNnRDSDRPc3Q2aFpwUmgwbmc3QzFaYS9Cc0FONkFISndYUmJqc2ZiT0oxL2l5OUNrblN3VmE4V01waHNodzVTazFrdEtwQnB1bTNJQ0ZGc1E9PVwiLFwiZGF0ZVwiOlwiV2VkLCAxNyBKYW4gMjAxOCAxOTozNjoyMyBHTVRcIixcImNvbm5lY3Rpb25cIjpcImNsb3NlXCIsXCJjb250ZW50LWxlbmd0aFwiOlwiMTM5XCJ9LFwic3RhdHVzQ29kZVwiOjQwMCxcImJvZHlcIjp7XCJlcnJvclwiOntcIm1lc3NhZ2VcIjpcIigjMTAwKSBObyBtYXRjaGluZyB1c2VyIGZvdW5kXCIsXCJ0eXBlXCI6XCJPQXV0aEV4Y2VwdGlvblwiLFwiY29kZVwiOjEwMCxcImVycm9yX3N1YmNvZGVcIjoyMDE4MDAxLFwiZmJ0cmFjZV9pZFwiOlwiSDZIejlSUHF4U0JcIn19fX0ifQ==",
//                 "approximateArrivalTimestamp": 1516217842.062
//             },
//             "eventSource": "aws:kinesis",
//             "eventVersion": "1.0",
//             "eventID": "shardId-000000000003:49580831982549757066933184131143068709215562117733679154",
//             "eventName": "aws:kinesis:record",
//             "invokeIdentityArn": "arn:aws:iam::774515094505:role/lambda-smiles",
//             "awsRegion": "us-east-1",
//             "eventSourceARN": "arn:aws:kinesis:us-east-1:774515094505:stream/external-logs-to-es"
//         },
//         {
//             "kinesis": {
//                 "kinesisSchemaVersion": "1.0",
//                 "partitionKey": "bluemix-nodered",
//                 "sequenceNumber": "49580831982549757066933184131144277635035176746908385330",
//                 "data": "eyJEYXRhIjoicmVxdWVzdC1tZXRyaWNzLWpzXHR7XCJ1cmlcIjpcIi92Mi42L21lL21lc3NhZ2VzP2FjY2Vzc190b2tlbj1FQUFKekdaQThoMEtJQkFDVUVSeFhtcWs5R2tJRWtGZVF5dFlaQVpBZ0FBMWZaQk1YNmVzOEs5UVJWSG04Um1kTVNBd0t0NUVKSWlUc1FJUmxCRzRqSFRXMXA0VXNMSVNNOTF0OTBCQ3dqdERaQUpjM3JpNVdTc2ZGWkFaQnRUMWZ5TWZzdmYzOUxqMGFqZGk2Z2wwMGxaQWY5blRuNElpNEdxdlAzSTMyTGFDckpBWkRaRFwiLFwiZHVyYXRpb25cIjoyNjEsXCJoYXNFcnJvclwiOnRydWUsXCJyZXF1ZXN0XCI6e1wiaGVhZGVyc1wiOntcImFjY2VwdFwiOlwiYXBwbGljYXRpb24vanNvblwiLFwiY29udGVudC10eXBlXCI6XCJhcHBsaWNhdGlvbi9qc29uXCIsXCJjb250ZW50LWxlbmd0aFwiOjI1Mzh9LFwiYm9keVwiOlwie1xcXCJyZWNpcGllbnRcXFwiOntcXFwiaWRcXFwiOlxcXCIzODM4MjUyODQyODgxOTYwXFxcIn0sXFxcIm1lc3NhZ2VcXFwiOntcXFwidGV4dFxcXCI6XFxcIk7Do28gZW50ZW5kaSBvIHF1ZSB2b2PDqiBxdWVyLiBTb2JyZSBvIHF1ZSBkZXNlamEgZmFsYXI/XFxcIixcXFwicXVpY2tfcmVwbGllc1xcXCI6W3tcXFwiY29udGVudF90eXBlXFxcIjpcXFwidGV4dFxcXCIsXFxcInRpdGxlXFxcIjpcXFwiUHJvbW/Dp8O1ZXNcXFwiLFxcXCJwYXlsb2FkXFxcIjpcXFwicXVpY2tfcmVwbHlcXFwifSx7XFxcImNvbnRlbnRfdHlwZVxcXCI6XFxcInRleHRcXFwiLFxcXCJ0aXRsZVxcXCI6XFxcIkJ1c2NhciB2b29cXFwiLFxcXCJwYXlsb2FkXFxcIjpcXFwicXVpY2tfcmVwbHlcXFwifSx7XFxcImNvbnRlbnRfdHlwZVxcXCI6XFxcInRleHRcXFwiLFxcXCJ0aXRsZVxcXCI6XFxcIkNhZGFzdHJhclxcXCIsXFxcInBheWxvYWRcXFwiOlxcXCJxdWlja19yZXBseVxcXCJ9LHtcXFwiY29udGVudF90eXBlXFxcIjpcXFwidGV4dFxcXCIsXFxcInRpdGxlXFxcIjpcXFwiRmFsZSBjb20gU21pbGVzXFxcIixcXFwicGF5bG9hZFxcXCI6XFxcInF1aWNrX3JlcGx5XFxcIn1dfSxcXFwiY29udGV4dFxcXCI6e1xcXCJ0aW1lem9uZVxcXCI6XFxcIkdNVHVuZGVmaW5lZFxcXCIsXFxcImZsaWdodF9jb3VudGVyXFxcIjowLFxcXCJmbGlnaHRCYWNrX2NvdW50ZXJcXFwiOjAsXFxcInNtaWxlc191cmxzXFxcIjp7XFxcInJlY3VwZXJhcl9zZW5oYVxcXCI6XFxcImh0dHBzOi8vZ29vLmdsL3BhSllORVxcXCIsXFxcImNvbXByYXJfbWlsaGFzXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvWm5iWWZUXFxcIixcXFwibWV1c192b29zXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvQXJGSkNyXFxcIixcXFwiYmFnYWdlbnNfZV9hc3NlbnRvc1xcXCI6XFxcImh0dHBzOi8vZ29vLmdsL3Q3RTJWUVxcXCIsXFxcIndlYnNpdGVcXFwiOlxcXCJodHRwczovL2dvby5nbC83a1dESzdcXFwiLFxcXCJjbHViZV9zbWlsZXNcXFwiOlxcXCJodHRwczovL2dvby5nbC9VUjczTXZcXFwiLFxcXCJ0ZXJtb3NfZGVfdmlhZ2VtXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvZjFZdFpHXFxcIixcXFwicGFnaW5hX2xvZ2luXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvUGRKTkV4XFxcIixcXFwiaGVscFxcXCI6XFxcImh0dHBzOi8vZ29vLmdsL2tkZ2NiN1xcXCIsXFxcImFjY2Vzc19hY2NvdW50XFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvSkpFbllYXFxcIn0sXFxcImxpbWl0c0ZvckJvb2tpbmdcXFwiOntcXFwibG93ZXJcXFwiOntcXFwiZGF0ZVxcXCI6XFxcIjIwMTgtMDEtMTdcXFwiLFxcXCJob3VyXFxcIjpcXFwiMDU6MzZcXFwifSxcXFwidXBwZXJcXFwiOntcXFwiZGF0ZVxcXCI6XFxcIjIwMTgtMTItMTNcXFwiLFxcXCJob3VyXFxcIjpcXFwiMDU6MzZcXFwifSxcXFwiY3VycmVudFxcXCI6e1xcXCJkYXRlXFxcIjpcXFwiMjAxOC0wMS0xN1xcXCIsXFxcImhvdXJcXFwiOlxcXCIwNTozNlxcXCJ9fSxcXFwibW9udGhMYXN0RGF0ZVxcXCI6XFxcIjMxLzAxLzIwMThcXFwiLFxcXCJjb252ZXJzYXRpb25faWRcXFwiOlxcXCI0YmI4MDIyNS05M2YzLTRmZDYtOGVlMy02YzU1ZDMyYzVhZDhcXFwiLFxcXCJzeXN0ZW1cXFwiOntcXFwiZGlhbG9nX3N0YWNrXFxcIjpbe1xcXCJkaWFsb2dfbm9kZVxcXCI6XFxcInJvb3RcXFwifV0sXFxcImRpYWxvZ190dXJuX2NvdW50ZXJcXFwiOjUsXFxcImRpYWxvZ19yZXF1ZXN0X2NvdW50ZXJcXFwiOjUsXFxcIl9ub2RlX291dHB1dF9tYXBcXFwiOntcXFwiQmVtLXZpbmRvXFxcIjpbMF0sXFxcIkVtIG91dHJvcyBjYXNvc1xcXCI6WzBdfSxcXFwiYnJhbmNoX2V4aXRlZFxcXCI6dHJ1ZSxcXFwiYnJhbmNoX2V4aXRlZF9yZWFzb25cXFwiOlxcXCJjb21wbGV0ZWRcXFwifSxcXFwidG9cXFwiOlxcXCJcXFwiLFxcXCJ0YXhcXFwiOlxcXCJcXFwiLFxcXCJmcm9tXFxcIjpcXFwiXFxcIixcXFwidGVybVxcXCI6XFxcIlxcXCIsXFxcImF0aXZvXFxcIjpcXFwiXFxcIixcXFwiY2x1YmVcXFwiOlxcXCJcXFwiLFxcXCJvcHRpblxcXCI6ZmFsc2UsXFxcInRpbWVyXFxcIjpcXFwiXFxcIixcXFwidG9kYXlcXFwiOlxcXCJcXFwiLFxcXCJpbnRlbnRcXFwiOlxcXCJcXFwiLFxcXCJtZW1iZXJcXFwiOlxcXCJcXFwiLFxcXCJyZXR1cm5cXFwiOlxcXCJcXFwiLFxcXCJzZWFyY2hcXFwiOlxcXCJcXFwiLFxcXCJvcHRpb25zXFxcIjpbXFxcIlByb21vw6fDtWVzXFxcIixcXFwiQnVzY2FyIHZvb1xcXCIsXFxcIkNhZGFzdHJhclxcXCIsXFxcIkZhbGUgY29tIFNtaWxlc1xcXCJdLFxcXCJzdW1tYXJ5XFxcIjpcXFwiXFxcIixcXFwiYWlycG9ydHNcXFwiOlxcXCJcXFwiLFxcXCJkYXRhX2lkYVxcXCI6XFxcIlxcXCIsXFxcImVsZWdpdmVsXFxcIjpudWxsLFxcXCJyZWdpc3RlclxcXCI6bnVsbCxcXFwiY2hlY2tEYXRlXFxcIjpcXFwiXFxcIixcXFwiY3BmVmFsaWRvXFxcIjpcXFwiXFxcIixcXFwiZGVwYXJ0dXJlXFxcIjpcXFwiXFxcIixcXFwiY2hlY2tFbWFpbFxcXCI6XFxcIlxcXCIsXFxcImNoZWNrX2RhdGVcXFwiOlxcXCJcXFwiLFxcXCJkYXRhX3ZvbHRhXFxcIjpcXFwiXFxcIixcXFwicGFzc2VuZ2Vyc1xcXCI6XFxcIlxcXCIsXFxcInByb21vQ2x1YmVcXFwiOm51bGwsXFxcInZhbGlkYXJDUEZcXFwiOm51bGwsXFxcInJnX2NhZGFzdHJvXFxcIjpmYWxzZSxcXFwic2VhcmNoT3JkZXJcXFwiOlxcXCJcXFwiLFxcXCJ2YWxpZGFyX2NwZlxcXCI6XFxcIlxcXCIsXFxcImNwZl9jYWRhc3Ryb1xcXCI6ZmFsc2UsXFxcImVtYWlsX3ZhbGlkb1xcXCI6XFxcIlxcXCIsXFxcIm9yaWdlbV9idXNjYVxcXCI6XFxcIlxcXCIsXFxcInByb21vRW50ZW5kYVxcXCI6bnVsbCxcXFwic21pbGVzVmFsaWRvXFxcIjpcXFwiXFxcIixcXFwidmFsaWRhcl90eXBlXFxcIjpcXFwiXFxcIixcXFwiZGF0YV9jYWRhc3Ryb1xcXCI6ZmFsc2UsXFxcImRlc3Rpbm9fYnVzY2FcXFwiOlxcXCJcXFwiLFxcXCJmYXplckNhZGFzdHJvXFxcIjpudWxsLFxcXCJub21lX2NhZGFzdHJvXFxcIjpmYWxzZSxcXFwic2VhcmNoX2ZsaWdodFxcXCI6XFxcIlxcXCIsXFxcImRlc2NvbnRvX2NsdWJlXFxcIjpcXFwiXFxcIixcXFwiZW1haWxfY2FkYXN0cm9cXFwiOmZhbHNlLFxcXCJwcm9tb1BhcnRpY2lwZVxcXCI6bnVsbCxcXFwic2VudFRvQ2hlY2tvdXRcXFwiOlxcXCJcXFwiLFxcXCJhZGRfdG9fY2hlY2tvdXRcXFwiOlxcXCJcXFwiLFxcXCJnZW5lcm9fY2FkYXN0cm9cXFwiOmZhbHNlLFxcXCJwYXNzZW5nZXJfZW1haWxcXFwiOlxcXCJcXFwiLFxcXCJyZXR1cm5fc2VsZWN0ZWRcXFwiOlxcXCJcXFwiLFxcXCJzZWFyY2hGYXZvcml0ZXNcXFwiOlxcXCJcXFwiLFxcXCJzZWdtZW50U2VsZWN0ZWRcXFwiOm51bGwsXFxcIm11bHRpcGxlX2FpcnBvcnRzXFxcIjpcXFwiXFxcIixcXFwicGFzc2FnZWlyb3NfYmViZXNcXFwiOlxcXCJcXFwiLFxcXCJzZWxlY3RlZF9mYXZvcml0ZVxcXCI6XFxcIlxcXCIsXFxcInRvdGFsX3Bhc3NhZ2Vpcm9zXFxcIjpcXFwiXFxcIixcXFwiZGVwYXJ0dXJlX3NlbGVjdGVkXFxcIjpcXFwiXFxcIixcXFwic29icmVub21lX2NhZGFzdHJvXFxcIjpmYWxzZSxcXFwicGFzc2FnZWlyb3NfYWR1bHRvc1xcXCI6XFxcIlxcXCIsXFxcInBhc3NhZ2Vpcm9zX2NyaWFuY2FzXFxcIjpcXFwiXFxcIixcXFwicmV0dXJuX3NlbGVjdGVkX2ZsaWdodFxcXCI6bnVsbCxcXFwiZGVwYXJ0dXJlX3NlbGVjdGVkX2ZsaWdodFxcXCI6bnVsbH19XCJ9LFwicmVzcG9uc2VGYXVsdFwiOntcImhlYWRlcnNcIjp7XCJ4LXBhZ2UtdXNhZ2VcIjpcIntcXFwiY2FsbF9jb3VudFxcXCI6MSxcXFwidG90YWxfY3B1dGltZVxcXCI6MSxcXFwidG90YWxfdGltZVxcXCI6MX1cIixcImFjY2Vzcy1jb250cm9sLWFsbG93LW9yaWdpblwiOlwiKlwiLFwic3RyaWN0LXRyYW5zcG9ydC1zZWN1cml0eVwiOlwibWF4LWFnZT0xNTU1MjAwMDsgcHJlbG9hZFwiLFwieC1mYi10cmFjZS1pZFwiOlwiRWtPUnQvblNyelRcIixcIngtZmItcmV2XCI6XCIzNTc4MTc1XCIsXCJjb250ZW50LXR5cGVcIjpcImFwcGxpY2F0aW9uL2pzb25cIixcImZhY2Vib29rLWFwaS12ZXJzaW9uXCI6XCJ2Mi4xMFwiLFwiY2FjaGUtY29udHJvbFwiOlwibm8tc3RvcmVcIixcInByYWdtYVwiOlwibm8tY2FjaGVcIixcImV4cGlyZXNcIjpcIlNhdCwgMDEgSmFuIDIwMDAgMDA6MDA6MDAgR01UXCIsXCJ3d3ctYXV0aGVudGljYXRlXCI6XCJPQXV0aCBcXFwiRmFjZWJvb2sgUGxhdGZvcm1cXFwiIFxcXCJpbnZhbGlkX3JlcXVlc3RcXFwiIFxcXCIoIzEwMCkgTm8gbWF0Y2hpbmcgdXNlciBmb3VuZFxcXCJcIixcIngtZmItZGVidWdcIjpcIk9scXhGSGM3UVRWOFRIelJrZ1g4aFFPK0VneGo5bFgvMGx2M0p1VjJFUi8vb2dRSWwxZHlzREJDV1FpNGxnSVNrWUVvdVJTdjdzeU1nQ0d1Ry8rWVFnPT1cIixcImRhdGVcIjpcIldlZCwgMTcgSmFuIDIwMTggMTk6MzY6MjkgR01UXCIsXCJjb25uZWN0aW9uXCI6XCJjbG9zZVwiLFwiY29udGVudC1sZW5ndGhcIjpcIjE0MFwifSxcInN0YXR1c0NvZGVcIjo0MDAsXCJib2R5XCI6e1wiZXJyb3JcIjp7XCJtZXNzYWdlXCI6XCIoIzEwMCkgTm8gbWF0Y2hpbmcgdXNlciBmb3VuZFwiLFwidHlwZVwiOlwiT0F1dGhFeGNlcHRpb25cIixcImNvZGVcIjoxMDAsXCJlcnJvcl9zdWJjb2RlXCI6MjAxODAwMSxcImZidHJhY2VfaWRcIjpcIkVrT1J0L25TcnpUXCJ9fX19In0=",
//                 "approximateArrivalTimestamp": 1516217842.065
//             },
//             "eventSource": "aws:kinesis",
//             "eventVersion": "1.0",
//             "eventID": "shardId-000000000003:49580831982549757066933184131144277635035176746908385330",
//             "eventName": "aws:kinesis:record",
//             "invokeIdentityArn": "arn:aws:iam::774515094505:role/lambda-smiles",
//             "awsRegion": "us-east-1",
//             "eventSourceARN": "arn:aws:kinesis:us-east-1:774515094505:stream/external-logs-to-es"
//         },
//         {
//             "kinesis": {
//                 "kinesisSchemaVersion": "1.0",
//                 "partitionKey": "bluemix-nodered",
//                 "sequenceNumber": "49580831982549757066933184131145486560854809311866519602",
//                 "data": "eyJEYXRhIjoicmVxdWVzdC1tZXRyaWNzLWpzXHR7XCJ1cmlcIjpcIi92Mi42L21lL21lc3NhZ2VzP2FjY2Vzc190b2tlbj1FQUFKekdaQThoMEtJQkFDVUVSeFhtcWs5R2tJRWtGZVF5dFlaQVpBZ0FBMWZaQk1YNmVzOEs5UVJWSG04Um1kTVNBd0t0NUVKSWlUc1FJUmxCRzRqSFRXMXA0VXNMSVNNOTF0OTBCQ3dqdERaQUpjM3JpNVdTc2ZGWkFaQnRUMWZ5TWZzdmYzOUxqMGFqZGk2Z2wwMGxaQWY5blRuNElpNEdxdlAzSTMyTGFDckpBWkRaRFwiLFwiZHVyYXRpb25cIjoyMjIsXCJoYXNFcnJvclwiOnRydWUsXCJyZXF1ZXN0XCI6e1wiaGVhZGVyc1wiOntcImFjY2VwdFwiOlwiYXBwbGljYXRpb24vanNvblwiLFwiY29udGVudC10eXBlXCI6XCJhcHBsaWNhdGlvbi9qc29uXCIsXCJjb250ZW50LWxlbmd0aFwiOjY3fSxcImJvZHlcIjpcIntcXFwicmVjaXBpZW50XFxcIjp7XFxcImlkXFxcIjpcXFwiMzgzODI1Mjg0Mjg4MTk2MFxcXCJ9LFxcXCJzZW5kZXJfYWN0aW9uXFxcIjpcXFwidHlwaW5nX29uXFxcIn1cIn0sXCJyZXNwb25zZUZhdWx0XCI6e1wiaGVhZGVyc1wiOntcIngtcGFnZS11c2FnZVwiOlwie1xcXCJjYWxsX2NvdW50XFxcIjoxLFxcXCJ0b3RhbF9jcHV0aW1lXFxcIjoxLFxcXCJ0b3RhbF90aW1lXFxcIjoxfVwiLFwiYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luXCI6XCIqXCIsXCJzdHJpY3QtdHJhbnNwb3J0LXNlY3VyaXR5XCI6XCJtYXgtYWdlPTE1NTUyMDAwOyBwcmVsb2FkXCIsXCJ4LWZiLXRyYWNlLWlkXCI6XCJGcUJiS25jWXgvNVwiLFwieC1mYi1yZXZcIjpcIjM1NzgxNzVcIixcImNvbnRlbnQtdHlwZVwiOlwiYXBwbGljYXRpb24vanNvblwiLFwiZmFjZWJvb2stYXBpLXZlcnNpb25cIjpcInYyLjEwXCIsXCJjYWNoZS1jb250cm9sXCI6XCJuby1zdG9yZVwiLFwicHJhZ21hXCI6XCJuby1jYWNoZVwiLFwiZXhwaXJlc1wiOlwiU2F0LCAwMSBKYW4gMjAwMCAwMDowMDowMCBHTVRcIixcInd3dy1hdXRoZW50aWNhdGVcIjpcIk9BdXRoIFxcXCJGYWNlYm9vayBQbGF0Zm9ybVxcXCIgXFxcImludmFsaWRfcmVxdWVzdFxcXCIgXFxcIigjMTAwKSBObyBtYXRjaGluZyB1c2VyIGZvdW5kXFxcIlwiLFwieC1mYi1kZWJ1Z1wiOlwic0g0R2M3UmR1SkZaQytnMDdXOWE3WSsvQXlpT01pY0xFTDhaYWNCUEUxUFBIQUJOL05VOU0wUkNGY0c4RE9xVU9FbUJXajIrUUlwRjN4c2xsU3BXY1E9PVwiLFwiZGF0ZVwiOlwiV2VkLCAxNyBKYW4gMjAxOCAxOTozODowOCBHTVRcIixcImNvbm5lY3Rpb25cIjpcImNsb3NlXCIsXCJjb250ZW50LWxlbmd0aFwiOlwiMTQwXCJ9LFwic3RhdHVzQ29kZVwiOjQwMCxcImJvZHlcIjp7XCJlcnJvclwiOntcIm1lc3NhZ2VcIjpcIigjMTAwKSBObyBtYXRjaGluZyB1c2VyIGZvdW5kXCIsXCJ0eXBlXCI6XCJPQXV0aEV4Y2VwdGlvblwiLFwiY29kZVwiOjEwMCxcImVycm9yX3N1YmNvZGVcIjoyMDE4MDAxLFwiZmJ0cmFjZV9pZFwiOlwiRnFCYktuY1l4LzVcIn19fX0ifQ==",
//                 "approximateArrivalTimestamp": 1516218102.463
//             },
//             "eventSource": "aws:kinesis",
//             "eventVersion": "1.0",
//             "eventID": "shardId-000000000003:49580831982549757066933184131145486560854809311866519602",
//             "eventName": "aws:kinesis:record",
//             "invokeIdentityArn": "arn:aws:iam::774515094505:role/lambda-smiles",
//             "awsRegion": "us-east-1",
//             "eventSourceARN": "arn:aws:kinesis:us-east-1:774515094505:stream/external-logs-to-es"
//         },
//         {
//             "kinesis": {
//                 "kinesisSchemaVersion": "1.0",
//                 "partitionKey": "bluemix-nodered",
//                 "sequenceNumber": "49580831982549757066933184131146695486674423941041225778",
//                 "data": "eyJEYXRhIjoicmVxdWVzdC1tZXRyaWNzLWpzXHR7XCJ1cmlcIjpcIi92Mi42L21lL21lc3NhZ2VzP2FjY2Vzc190b2tlbj1FQUFKekdaQThoMEtJQkFDVUVSeFhtcWs5R2tJRWtGZVF5dFlaQVpBZ0FBMWZaQk1YNmVzOEs5UVJWSG04Um1kTVNBd0t0NUVKSWlUc1FJUmxCRzRqSFRXMXA0VXNMSVNNOTF0OTBCQ3dqdERaQUpjM3JpNVdTc2ZGWkFaQnRUMWZ5TWZzdmYzOUxqMGFqZGk2Z2wwMGxaQWY5blRuNElpNEdxdlAzSTMyTGFDckpBWkRaRFwiLFwiZHVyYXRpb25cIjoyMjQsXCJoYXNFcnJvclwiOnRydWUsXCJyZXF1ZXN0XCI6e1wiaGVhZGVyc1wiOntcImFjY2VwdFwiOlwiYXBwbGljYXRpb24vanNvblwiLFwiY29udGVudC10eXBlXCI6XCJhcHBsaWNhdGlvbi9qc29uXCIsXCJjb250ZW50LWxlbmd0aFwiOjI1Mzh9LFwiYm9keVwiOlwie1xcXCJyZWNpcGllbnRcXFwiOntcXFwiaWRcXFwiOlxcXCIzODM4MjUyODQyODgxOTYwXFxcIn0sXFxcIm1lc3NhZ2VcXFwiOntcXFwidGV4dFxcXCI6XFxcIk7Do28gZW50ZW5kaSBvIHF1ZSB2b2PDqiBxdWVyLiBTb2JyZSBvIHF1ZSBkZXNlamEgZmFsYXI/XFxcIixcXFwicXVpY2tfcmVwbGllc1xcXCI6W3tcXFwiY29udGVudF90eXBlXFxcIjpcXFwidGV4dFxcXCIsXFxcInRpdGxlXFxcIjpcXFwiUHJvbW/Dp8O1ZXNcXFwiLFxcXCJwYXlsb2FkXFxcIjpcXFwicXVpY2tfcmVwbHlcXFwifSx7XFxcImNvbnRlbnRfdHlwZVxcXCI6XFxcInRleHRcXFwiLFxcXCJ0aXRsZVxcXCI6XFxcIkJ1c2NhciB2b29cXFwiLFxcXCJwYXlsb2FkXFxcIjpcXFwicXVpY2tfcmVwbHlcXFwifSx7XFxcImNvbnRlbnRfdHlwZVxcXCI6XFxcInRleHRcXFwiLFxcXCJ0aXRsZVxcXCI6XFxcIkNhZGFzdHJhclxcXCIsXFxcInBheWxvYWRcXFwiOlxcXCJxdWlja19yZXBseVxcXCJ9LHtcXFwiY29udGVudF90eXBlXFxcIjpcXFwidGV4dFxcXCIsXFxcInRpdGxlXFxcIjpcXFwiRmFsZSBjb20gU21pbGVzXFxcIixcXFwicGF5bG9hZFxcXCI6XFxcInF1aWNrX3JlcGx5XFxcIn1dfSxcXFwiY29udGV4dFxcXCI6e1xcXCJ0aW1lem9uZVxcXCI6XFxcIkdNVHVuZGVmaW5lZFxcXCIsXFxcImZsaWdodF9jb3VudGVyXFxcIjowLFxcXCJmbGlnaHRCYWNrX2NvdW50ZXJcXFwiOjAsXFxcInNtaWxlc191cmxzXFxcIjp7XFxcInJlY3VwZXJhcl9zZW5oYVxcXCI6XFxcImh0dHBzOi8vZ29vLmdsL3BhSllORVxcXCIsXFxcImNvbXByYXJfbWlsaGFzXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvWm5iWWZUXFxcIixcXFwibWV1c192b29zXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvQXJGSkNyXFxcIixcXFwiYmFnYWdlbnNfZV9hc3NlbnRvc1xcXCI6XFxcImh0dHBzOi8vZ29vLmdsL3Q3RTJWUVxcXCIsXFxcIndlYnNpdGVcXFwiOlxcXCJodHRwczovL2dvby5nbC83a1dESzdcXFwiLFxcXCJjbHViZV9zbWlsZXNcXFwiOlxcXCJodHRwczovL2dvby5nbC9VUjczTXZcXFwiLFxcXCJ0ZXJtb3NfZGVfdmlhZ2VtXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvZjFZdFpHXFxcIixcXFwicGFnaW5hX2xvZ2luXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvUGRKTkV4XFxcIixcXFwiaGVscFxcXCI6XFxcImh0dHBzOi8vZ29vLmdsL2tkZ2NiN1xcXCIsXFxcImFjY2Vzc19hY2NvdW50XFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvSkpFbllYXFxcIn0sXFxcImxpbWl0c0ZvckJvb2tpbmdcXFwiOntcXFwibG93ZXJcXFwiOntcXFwiZGF0ZVxcXCI6XFxcIjIwMTgtMDEtMTdcXFwiLFxcXCJob3VyXFxcIjpcXFwiMDU6MzhcXFwifSxcXFwidXBwZXJcXFwiOntcXFwiZGF0ZVxcXCI6XFxcIjIwMTgtMTItMTNcXFwiLFxcXCJob3VyXFxcIjpcXFwiMDU6MzhcXFwifSxcXFwiY3VycmVudFxcXCI6e1xcXCJkYXRlXFxcIjpcXFwiMjAxOC0wMS0xN1xcXCIsXFxcImhvdXJcXFwiOlxcXCIwNTozOFxcXCJ9fSxcXFwibW9udGhMYXN0RGF0ZVxcXCI6XFxcIjMxLzAxLzIwMThcXFwiLFxcXCJjb252ZXJzYXRpb25faWRcXFwiOlxcXCI0YmI4MDIyNS05M2YzLTRmZDYtOGVlMy02YzU1ZDMyYzVhZDhcXFwiLFxcXCJzeXN0ZW1cXFwiOntcXFwiZGlhbG9nX3N0YWNrXFxcIjpbe1xcXCJkaWFsb2dfbm9kZVxcXCI6XFxcInJvb3RcXFwifV0sXFxcImRpYWxvZ190dXJuX2NvdW50ZXJcXFwiOjYsXFxcImRpYWxvZ19yZXF1ZXN0X2NvdW50ZXJcXFwiOjYsXFxcIl9ub2RlX291dHB1dF9tYXBcXFwiOntcXFwiQmVtLXZpbmRvXFxcIjpbMF0sXFxcIkVtIG91dHJvcyBjYXNvc1xcXCI6WzBdfSxcXFwiYnJhbmNoX2V4aXRlZFxcXCI6dHJ1ZSxcXFwiYnJhbmNoX2V4aXRlZF9yZWFzb25cXFwiOlxcXCJjb21wbGV0ZWRcXFwifSxcXFwidG9cXFwiOlxcXCJcXFwiLFxcXCJ0YXhcXFwiOlxcXCJcXFwiLFxcXCJmcm9tXFxcIjpcXFwiXFxcIixcXFwidGVybVxcXCI6XFxcIlxcXCIsXFxcImF0aXZvXFxcIjpcXFwiXFxcIixcXFwiY2x1YmVcXFwiOlxcXCJcXFwiLFxcXCJvcHRpblxcXCI6ZmFsc2UsXFxcInRpbWVyXFxcIjpcXFwiXFxcIixcXFwidG9kYXlcXFwiOlxcXCJcXFwiLFxcXCJpbnRlbnRcXFwiOlxcXCJcXFwiLFxcXCJtZW1iZXJcXFwiOlxcXCJcXFwiLFxcXCJyZXR1cm5cXFwiOlxcXCJcXFwiLFxcXCJzZWFyY2hcXFwiOlxcXCJcXFwiLFxcXCJvcHRpb25zXFxcIjpbXFxcIlByb21vw6fDtWVzXFxcIixcXFwiQnVzY2FyIHZvb1xcXCIsXFxcIkNhZGFzdHJhclxcXCIsXFxcIkZhbGUgY29tIFNtaWxlc1xcXCJdLFxcXCJzdW1tYXJ5XFxcIjpcXFwiXFxcIixcXFwiYWlycG9ydHNcXFwiOlxcXCJcXFwiLFxcXCJkYXRhX2lkYVxcXCI6XFxcIlxcXCIsXFxcImVsZWdpdmVsXFxcIjpudWxsLFxcXCJyZWdpc3RlclxcXCI6bnVsbCxcXFwiY2hlY2tEYXRlXFxcIjpcXFwiXFxcIixcXFwiY3BmVmFsaWRvXFxcIjpcXFwiXFxcIixcXFwiZGVwYXJ0dXJlXFxcIjpcXFwiXFxcIixcXFwiY2hlY2tFbWFpbFxcXCI6XFxcIlxcXCIsXFxcImNoZWNrX2RhdGVcXFwiOlxcXCJcXFwiLFxcXCJkYXRhX3ZvbHRhXFxcIjpcXFwiXFxcIixcXFwicGFzc2VuZ2Vyc1xcXCI6XFxcIlxcXCIsXFxcInByb21vQ2x1YmVcXFwiOm51bGwsXFxcInZhbGlkYXJDUEZcXFwiOm51bGwsXFxcInJnX2NhZGFzdHJvXFxcIjpmYWxzZSxcXFwic2VhcmNoT3JkZXJcXFwiOlxcXCJcXFwiLFxcXCJ2YWxpZGFyX2NwZlxcXCI6XFxcIlxcXCIsXFxcImNwZl9jYWRhc3Ryb1xcXCI6ZmFsc2UsXFxcImVtYWlsX3ZhbGlkb1xcXCI6XFxcIlxcXCIsXFxcIm9yaWdlbV9idXNjYVxcXCI6XFxcIlxcXCIsXFxcInByb21vRW50ZW5kYVxcXCI6bnVsbCxcXFwic21pbGVzVmFsaWRvXFxcIjpcXFwiXFxcIixcXFwidmFsaWRhcl90eXBlXFxcIjpcXFwiXFxcIixcXFwiZGF0YV9jYWRhc3Ryb1xcXCI6ZmFsc2UsXFxcImRlc3Rpbm9fYnVzY2FcXFwiOlxcXCJcXFwiLFxcXCJmYXplckNhZGFzdHJvXFxcIjpudWxsLFxcXCJub21lX2NhZGFzdHJvXFxcIjpmYWxzZSxcXFwic2VhcmNoX2ZsaWdodFxcXCI6XFxcIlxcXCIsXFxcImRlc2NvbnRvX2NsdWJlXFxcIjpcXFwiXFxcIixcXFwiZW1haWxfY2FkYXN0cm9cXFwiOmZhbHNlLFxcXCJwcm9tb1BhcnRpY2lwZVxcXCI6bnVsbCxcXFwic2VudFRvQ2hlY2tvdXRcXFwiOlxcXCJcXFwiLFxcXCJhZGRfdG9fY2hlY2tvdXRcXFwiOlxcXCJcXFwiLFxcXCJnZW5lcm9fY2FkYXN0cm9cXFwiOmZhbHNlLFxcXCJwYXNzZW5nZXJfZW1haWxcXFwiOlxcXCJcXFwiLFxcXCJyZXR1cm5fc2VsZWN0ZWRcXFwiOlxcXCJcXFwiLFxcXCJzZWFyY2hGYXZvcml0ZXNcXFwiOlxcXCJcXFwiLFxcXCJzZWdtZW50U2VsZWN0ZWRcXFwiOm51bGwsXFxcIm11bHRpcGxlX2FpcnBvcnRzXFxcIjpcXFwiXFxcIixcXFwicGFzc2FnZWlyb3NfYmViZXNcXFwiOlxcXCJcXFwiLFxcXCJzZWxlY3RlZF9mYXZvcml0ZVxcXCI6XFxcIlxcXCIsXFxcInRvdGFsX3Bhc3NhZ2Vpcm9zXFxcIjpcXFwiXFxcIixcXFwiZGVwYXJ0dXJlX3NlbGVjdGVkXFxcIjpcXFwiXFxcIixcXFwic29icmVub21lX2NhZGFzdHJvXFxcIjpmYWxzZSxcXFwicGFzc2FnZWlyb3NfYWR1bHRvc1xcXCI6XFxcIlxcXCIsXFxcInBhc3NhZ2Vpcm9zX2NyaWFuY2FzXFxcIjpcXFwiXFxcIixcXFwicmV0dXJuX3NlbGVjdGVkX2ZsaWdodFxcXCI6bnVsbCxcXFwiZGVwYXJ0dXJlX3NlbGVjdGVkX2ZsaWdodFxcXCI6bnVsbH19XCJ9LFwicmVzcG9uc2VGYXVsdFwiOntcImhlYWRlcnNcIjp7XCJ4LXBhZ2UtdXNhZ2VcIjpcIntcXFwiY2FsbF9jb3VudFxcXCI6MSxcXFwidG90YWxfY3B1dGltZVxcXCI6MSxcXFwidG90YWxfdGltZVxcXCI6MX1cIixcImFjY2Vzcy1jb250cm9sLWFsbG93LW9yaWdpblwiOlwiKlwiLFwic3RyaWN0LXRyYW5zcG9ydC1zZWN1cml0eVwiOlwibWF4LWFnZT0xNTU1MjAwMDsgcHJlbG9hZFwiLFwieC1mYi10cmFjZS1pZFwiOlwiQmhKRmRhNTgwSXpcIixcIngtZmItcmV2XCI6XCIzNTc4MTc1XCIsXCJjb250ZW50LXR5cGVcIjpcImFwcGxpY2F0aW9uL2pzb25cIixcImZhY2Vib29rLWFwaS12ZXJzaW9uXCI6XCJ2Mi4xMFwiLFwiY2FjaGUtY29udHJvbFwiOlwibm8tc3RvcmVcIixcInByYWdtYVwiOlwibm8tY2FjaGVcIixcImV4cGlyZXNcIjpcIlNhdCwgMDEgSmFuIDIwMDAgMDA6MDA6MDAgR01UXCIsXCJ3d3ctYXV0aGVudGljYXRlXCI6XCJPQXV0aCBcXFwiRmFjZWJvb2sgUGxhdGZvcm1cXFwiIFxcXCJpbnZhbGlkX3JlcXVlc3RcXFwiIFxcXCIoIzEwMCkgTm8gbWF0Y2hpbmcgdXNlciBmb3VuZFxcXCJcIixcIngtZmItZGVidWdcIjpcImlYKzlHc24zTDdMNk5qblJhQk15NG44WEFrR0xWLzlyUEJHOVgvTnhZZVFhVW5aRmw1SytWTVJPSy8rTE9VRUkxOFhqbTFEaDQvTFFCMDNZOEtUaW5nPT1cIixcImRhdGVcIjpcIldlZCwgMTcgSmFuIDIwMTggMTk6Mzg6MTYgR01UXCIsXCJjb25uZWN0aW9uXCI6XCJjbG9zZVwiLFwiY29udGVudC1sZW5ndGhcIjpcIjEzOVwifSxcInN0YXR1c0NvZGVcIjo0MDAsXCJib2R5XCI6e1wiZXJyb3JcIjp7XCJtZXNzYWdlXCI6XCIoIzEwMCkgTm8gbWF0Y2hpbmcgdXNlciBmb3VuZFwiLFwidHlwZVwiOlwiT0F1dGhFeGNlcHRpb25cIixcImNvZGVcIjoxMDAsXCJlcnJvcl9zdWJjb2RlXCI6MjAxODAwMSxcImZidHJhY2VfaWRcIjpcIkJoSkZkYTU4MEl6XCJ9fX19In0=",
//                 "approximateArrivalTimestamp": 1516218102.466
//             },
//             "eventSource": "aws:kinesis",
//             "eventVersion": "1.0",
//             "eventID": "shardId-000000000003:49580831982549757066933184131146695486674423941041225778",
//             "eventName": "aws:kinesis:record",
//             "invokeIdentityArn": "arn:aws:iam::774515094505:role/lambda-smiles",
//             "awsRegion": "us-east-1",
//             "eventSourceARN": "arn:aws:kinesis:us-east-1:774515094505:stream/external-logs-to-es"
//         }
//     ]
// })
