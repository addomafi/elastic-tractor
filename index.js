'use strict';

let path = require('path')
const zlib = require('zlib')
let ElasticTractor = require(path.join(__dirname, '.', 'elastictractor.js'))

console.log('Loading function');

exports.handler = function(event, context, callback) {
    let tractor = new ElasticTractor();
    // If it has records
    if (event.Records) {
      _.forEach(event.Records, function(evtRecord) {
        var evtSrc = evtRecord.eventSource;
        if (evtRecord.EventSource) {
          evtSrc = evtRecord.EventSource;
        }
        switch(evtSrc) {
          case "aws:s3":
            tractor.processS3(evtRecord).then(results => {
              callback(null, "Success");
            }).catch(err => {
              console.log(`Occurred an error "${JSON.stringify(err)}" on event ${JSON.stringify(evtRecord)}`)
              callback(null, "Success");
            });
            break;
          case "aws:sns":
            tractor.processSNS(evtRecord).then(results => {
              callback(null, "Success");
            }).catch(err => {
              console.log(`Occurred an error "${JSON.stringify(err)}" on event ${JSON.stringify(evtRecord)}`)
              callback(err, "Error");
            });
            break;
          case "aws:kinesis":
            tractor.processKinesis(evtRecord).then(results => {
              callback(null, "Success");
            }).catch(err => {
              console.log(`Occurred an error "${JSON.stringify(err)}" on event ${JSON.stringify(evtRecord)}`)
              callback(err, "Error");
            });
            break;
          default:
            console.log(`Event source "${evtRecord.eventSource}" is not supported. Event: ${JSON.stringify(evtRecord)}`)
            callback(null, "Success");
        }
      })
    } else {
      // Treat as a stream of CloudWatch Logs
      var buffer = Buffer.from(event.awslogs.data, 'base64')
      zlib.unzip(buffer, (err, buffer) => {
        if (!err) {
          tractor.processAwsLog(JSON.parse(buffer.toString())).then(results => {
            callback(null, "Success");
          }).catch(err => {
            console.log(`Occurred an error "${JSON.stringify(err)}" on aws-logs ${buffer.toString()}`)
            callback(null, "Success");
          });
        } else {
          console.log(`Occurred an error "${JSON.stringify(err)}" on aws-logs ${buffer.toString()}`)
          callback(null, "Success");
        }
      });
    }
};

// exports.handler({
// 	"awslogs": {
//     "data": "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"
//   }
// })

// exports.handler({
//     "Records": [
//         {
//             "kinesis": {
//                 "kinesisSchemaVersion": "1.0",
//                 "partitionKey": "bluemix-nodered",
//                 "sequenceNumber": "49580831982549757066933184131143068709215562117733679154",
//                 "data": "eyJEYXRhIjoicmVxdWVzdC1tZXRyaWNzLWpzXHR7XCJ1cmlcIjpcIi92Mi42L21lL21lc3NhZ2VzP2FjY2Vzc190b2tlbj1FQUFKekdaQThoMEtJQkFDVUVSeFhtcWs5R2tJRWtGZVF5dFlaQVpBZ0FBMWZaQk1YNmVzOEs5UVJWSG04Um1kTVNBd0t0NUVKSWlUc1FJUmxCRzRqSFRXMXA0VXNMSVNNOTF0OTBCQ3dqdERaQUpjM3JpNVdTc2ZGWkFaQnRUMWZ5TWZzdmYzOUxqMGFqZGk2Z2wwMGxaQWY5blRuNElpNEdxdlAzSTMyTGFDckpBWkRaRFwiLFwiZHVyYXRpb25cIjoyNDEsXCJoYXNFcnJvclwiOnRydWUsXCJyZXF1ZXN0XCI6e1wiaGVhZGVyc1wiOntcImFjY2VwdFwiOlwiYXBwbGljYXRpb24vanNvblwiLFwiY29udGVudC10eXBlXCI6XCJhcHBsaWNhdGlvbi9qc29uXCIsXCJjb250ZW50LWxlbmd0aFwiOjY3fSxcImJvZHlcIjpcIntcXFwicmVjaXBpZW50XFxcIjp7XFxcImlkXFxcIjpcXFwiMzgzODI1Mjg0Mjg4MTk2MFxcXCJ9LFxcXCJzZW5kZXJfYWN0aW9uXFxcIjpcXFwidHlwaW5nX29uXFxcIn1cIn0sXCJyZXNwb25zZUZhdWx0XCI6e1wiaGVhZGVyc1wiOntcIngtcGFnZS11c2FnZVwiOlwie1xcXCJjYWxsX2NvdW50XFxcIjoxLFxcXCJ0b3RhbF9jcHV0aW1lXFxcIjoxLFxcXCJ0b3RhbF90aW1lXFxcIjoxfVwiLFwiYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luXCI6XCIqXCIsXCJzdHJpY3QtdHJhbnNwb3J0LXNlY3VyaXR5XCI6XCJtYXgtYWdlPTE1NTUyMDAwOyBwcmVsb2FkXCIsXCJ4LWZiLXRyYWNlLWlkXCI6XCJINkh6OVJQcXhTQlwiLFwieC1mYi1yZXZcIjpcIjM1NzgxNzVcIixcImNvbnRlbnQtdHlwZVwiOlwiYXBwbGljYXRpb24vanNvblwiLFwiZmFjZWJvb2stYXBpLXZlcnNpb25cIjpcInYyLjEwXCIsXCJjYWNoZS1jb250cm9sXCI6XCJuby1zdG9yZVwiLFwicHJhZ21hXCI6XCJuby1jYWNoZVwiLFwiZXhwaXJlc1wiOlwiU2F0LCAwMSBKYW4gMjAwMCAwMDowMDowMCBHTVRcIixcInd3dy1hdXRoZW50aWNhdGVcIjpcIk9BdXRoIFxcXCJGYWNlYm9vayBQbGF0Zm9ybVxcXCIgXFxcImludmFsaWRfcmVxdWVzdFxcXCIgXFxcIigjMTAwKSBObyBtYXRjaGluZyB1c2VyIGZvdW5kXFxcIlwiLFwieC1mYi1kZWJ1Z1wiOlwiZU96bC9GNnRDSDRPc3Q2aFpwUmgwbmc3QzFaYS9Cc0FONkFISndYUmJqc2ZiT0oxL2l5OUNrblN3VmE4V01waHNodzVTazFrdEtwQnB1bTNJQ0ZGc1E9PVwiLFwiZGF0ZVwiOlwiV2VkLCAxNyBKYW4gMjAxOCAxOTozNjoyMyBHTVRcIixcImNvbm5lY3Rpb25cIjpcImNsb3NlXCIsXCJjb250ZW50LWxlbmd0aFwiOlwiMTM5XCJ9LFwic3RhdHVzQ29kZVwiOjQwMCxcImJvZHlcIjp7XCJlcnJvclwiOntcIm1lc3NhZ2VcIjpcIigjMTAwKSBObyBtYXRjaGluZyB1c2VyIGZvdW5kXCIsXCJ0eXBlXCI6XCJPQXV0aEV4Y2VwdGlvblwiLFwiY29kZVwiOjEwMCxcImVycm9yX3N1YmNvZGVcIjoyMDE4MDAxLFwiZmJ0cmFjZV9pZFwiOlwiSDZIejlSUHF4U0JcIn19fX0ifQ==",
//                 "approximateArrivalTimestamp": 1516217842.062
//             },
//             "eventSource": "aws:kinesis",
//             "eventVersion": "1.0",
//             "eventID": "shardId-000000000003:49580831982549757066933184131143068709215562117733679154",
//             "eventName": "aws:kinesis:record",
//             "invokeIdentityArn": "arn:aws:iam::774515094505:role/lambda-smiles",
//             "awsRegion": "us-east-1",
//             "eventSourceARN": "arn:aws:kinesis:us-east-1:774515094505:stream/external-logs-to-es"
//         },
//         {
//             "kinesis": {
//                 "kinesisSchemaVersion": "1.0",
//                 "partitionKey": "bluemix-nodered",
//                 "sequenceNumber": "49580831982549757066933184131144277635035176746908385330",
//                 "data": "eyJEYXRhIjoicmVxdWVzdC1tZXRyaWNzLWpzXHR7XCJ1cmlcIjpcIi92Mi42L21lL21lc3NhZ2VzP2FjY2Vzc190b2tlbj1FQUFKekdaQThoMEtJQkFDVUVSeFhtcWs5R2tJRWtGZVF5dFlaQVpBZ0FBMWZaQk1YNmVzOEs5UVJWSG04Um1kTVNBd0t0NUVKSWlUc1FJUmxCRzRqSFRXMXA0VXNMSVNNOTF0OTBCQ3dqdERaQUpjM3JpNVdTc2ZGWkFaQnRUMWZ5TWZzdmYzOUxqMGFqZGk2Z2wwMGxaQWY5blRuNElpNEdxdlAzSTMyTGFDckpBWkRaRFwiLFwiZHVyYXRpb25cIjoyNjEsXCJoYXNFcnJvclwiOnRydWUsXCJyZXF1ZXN0XCI6e1wiaGVhZGVyc1wiOntcImFjY2VwdFwiOlwiYXBwbGljYXRpb24vanNvblwiLFwiY29udGVudC10eXBlXCI6XCJhcHBsaWNhdGlvbi9qc29uXCIsXCJjb250ZW50LWxlbmd0aFwiOjI1Mzh9LFwiYm9keVwiOlwie1xcXCJyZWNpcGllbnRcXFwiOntcXFwiaWRcXFwiOlxcXCIzODM4MjUyODQyODgxOTYwXFxcIn0sXFxcIm1lc3NhZ2VcXFwiOntcXFwidGV4dFxcXCI6XFxcIk7Do28gZW50ZW5kaSBvIHF1ZSB2b2PDqiBxdWVyLiBTb2JyZSBvIHF1ZSBkZXNlamEgZmFsYXI/XFxcIixcXFwicXVpY2tfcmVwbGllc1xcXCI6W3tcXFwiY29udGVudF90eXBlXFxcIjpcXFwidGV4dFxcXCIsXFxcInRpdGxlXFxcIjpcXFwiUHJvbW/Dp8O1ZXNcXFwiLFxcXCJwYXlsb2FkXFxcIjpcXFwicXVpY2tfcmVwbHlcXFwifSx7XFxcImNvbnRlbnRfdHlwZVxcXCI6XFxcInRleHRcXFwiLFxcXCJ0aXRsZVxcXCI6XFxcIkJ1c2NhciB2b29cXFwiLFxcXCJwYXlsb2FkXFxcIjpcXFwicXVpY2tfcmVwbHlcXFwifSx7XFxcImNvbnRlbnRfdHlwZVxcXCI6XFxcInRleHRcXFwiLFxcXCJ0aXRsZVxcXCI6XFxcIkNhZGFzdHJhclxcXCIsXFxcInBheWxvYWRcXFwiOlxcXCJxdWlja19yZXBseVxcXCJ9LHtcXFwiY29udGVudF90eXBlXFxcIjpcXFwidGV4dFxcXCIsXFxcInRpdGxlXFxcIjpcXFwiRmFsZSBjb20gU21pbGVzXFxcIixcXFwicGF5bG9hZFxcXCI6XFxcInF1aWNrX3JlcGx5XFxcIn1dfSxcXFwiY29udGV4dFxcXCI6e1xcXCJ0aW1lem9uZVxcXCI6XFxcIkdNVHVuZGVmaW5lZFxcXCIsXFxcImZsaWdodF9jb3VudGVyXFxcIjowLFxcXCJmbGlnaHRCYWNrX2NvdW50ZXJcXFwiOjAsXFxcInNtaWxlc191cmxzXFxcIjp7XFxcInJlY3VwZXJhcl9zZW5oYVxcXCI6XFxcImh0dHBzOi8vZ29vLmdsL3BhSllORVxcXCIsXFxcImNvbXByYXJfbWlsaGFzXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvWm5iWWZUXFxcIixcXFwibWV1c192b29zXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvQXJGSkNyXFxcIixcXFwiYmFnYWdlbnNfZV9hc3NlbnRvc1xcXCI6XFxcImh0dHBzOi8vZ29vLmdsL3Q3RTJWUVxcXCIsXFxcIndlYnNpdGVcXFwiOlxcXCJodHRwczovL2dvby5nbC83a1dESzdcXFwiLFxcXCJjbHViZV9zbWlsZXNcXFwiOlxcXCJodHRwczovL2dvby5nbC9VUjczTXZcXFwiLFxcXCJ0ZXJtb3NfZGVfdmlhZ2VtXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvZjFZdFpHXFxcIixcXFwicGFnaW5hX2xvZ2luXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvUGRKTkV4XFxcIixcXFwiaGVscFxcXCI6XFxcImh0dHBzOi8vZ29vLmdsL2tkZ2NiN1xcXCIsXFxcImFjY2Vzc19hY2NvdW50XFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvSkpFbllYXFxcIn0sXFxcImxpbWl0c0ZvckJvb2tpbmdcXFwiOntcXFwibG93ZXJcXFwiOntcXFwiZGF0ZVxcXCI6XFxcIjIwMTgtMDEtMTdcXFwiLFxcXCJob3VyXFxcIjpcXFwiMDU6MzZcXFwifSxcXFwidXBwZXJcXFwiOntcXFwiZGF0ZVxcXCI6XFxcIjIwMTgtMTItMTNcXFwiLFxcXCJob3VyXFxcIjpcXFwiMDU6MzZcXFwifSxcXFwiY3VycmVudFxcXCI6e1xcXCJkYXRlXFxcIjpcXFwiMjAxOC0wMS0xN1xcXCIsXFxcImhvdXJcXFwiOlxcXCIwNTozNlxcXCJ9fSxcXFwibW9udGhMYXN0RGF0ZVxcXCI6XFxcIjMxLzAxLzIwMThcXFwiLFxcXCJjb252ZXJzYXRpb25faWRcXFwiOlxcXCI0YmI4MDIyNS05M2YzLTRmZDYtOGVlMy02YzU1ZDMyYzVhZDhcXFwiLFxcXCJzeXN0ZW1cXFwiOntcXFwiZGlhbG9nX3N0YWNrXFxcIjpbe1xcXCJkaWFsb2dfbm9kZVxcXCI6XFxcInJvb3RcXFwifV0sXFxcImRpYWxvZ190dXJuX2NvdW50ZXJcXFwiOjUsXFxcImRpYWxvZ19yZXF1ZXN0X2NvdW50ZXJcXFwiOjUsXFxcIl9ub2RlX291dHB1dF9tYXBcXFwiOntcXFwiQmVtLXZpbmRvXFxcIjpbMF0sXFxcIkVtIG91dHJvcyBjYXNvc1xcXCI6WzBdfSxcXFwiYnJhbmNoX2V4aXRlZFxcXCI6dHJ1ZSxcXFwiYnJhbmNoX2V4aXRlZF9yZWFzb25cXFwiOlxcXCJjb21wbGV0ZWRcXFwifSxcXFwidG9cXFwiOlxcXCJcXFwiLFxcXCJ0YXhcXFwiOlxcXCJcXFwiLFxcXCJmcm9tXFxcIjpcXFwiXFxcIixcXFwidGVybVxcXCI6XFxcIlxcXCIsXFxcImF0aXZvXFxcIjpcXFwiXFxcIixcXFwiY2x1YmVcXFwiOlxcXCJcXFwiLFxcXCJvcHRpblxcXCI6ZmFsc2UsXFxcInRpbWVyXFxcIjpcXFwiXFxcIixcXFwidG9kYXlcXFwiOlxcXCJcXFwiLFxcXCJpbnRlbnRcXFwiOlxcXCJcXFwiLFxcXCJtZW1iZXJcXFwiOlxcXCJcXFwiLFxcXCJyZXR1cm5cXFwiOlxcXCJcXFwiLFxcXCJzZWFyY2hcXFwiOlxcXCJcXFwiLFxcXCJvcHRpb25zXFxcIjpbXFxcIlByb21vw6fDtWVzXFxcIixcXFwiQnVzY2FyIHZvb1xcXCIsXFxcIkNhZGFzdHJhclxcXCIsXFxcIkZhbGUgY29tIFNtaWxlc1xcXCJdLFxcXCJzdW1tYXJ5XFxcIjpcXFwiXFxcIixcXFwiYWlycG9ydHNcXFwiOlxcXCJcXFwiLFxcXCJkYXRhX2lkYVxcXCI6XFxcIlxcXCIsXFxcImVsZWdpdmVsXFxcIjpudWxsLFxcXCJyZWdpc3RlclxcXCI6bnVsbCxcXFwiY2hlY2tEYXRlXFxcIjpcXFwiXFxcIixcXFwiY3BmVmFsaWRvXFxcIjpcXFwiXFxcIixcXFwiZGVwYXJ0dXJlXFxcIjpcXFwiXFxcIixcXFwiY2hlY2tFbWFpbFxcXCI6XFxcIlxcXCIsXFxcImNoZWNrX2RhdGVcXFwiOlxcXCJcXFwiLFxcXCJkYXRhX3ZvbHRhXFxcIjpcXFwiXFxcIixcXFwicGFzc2VuZ2Vyc1xcXCI6XFxcIlxcXCIsXFxcInByb21vQ2x1YmVcXFwiOm51bGwsXFxcInZhbGlkYXJDUEZcXFwiOm51bGwsXFxcInJnX2NhZGFzdHJvXFxcIjpmYWxzZSxcXFwic2VhcmNoT3JkZXJcXFwiOlxcXCJcXFwiLFxcXCJ2YWxpZGFyX2NwZlxcXCI6XFxcIlxcXCIsXFxcImNwZl9jYWRhc3Ryb1xcXCI6ZmFsc2UsXFxcImVtYWlsX3ZhbGlkb1xcXCI6XFxcIlxcXCIsXFxcIm9yaWdlbV9idXNjYVxcXCI6XFxcIlxcXCIsXFxcInByb21vRW50ZW5kYVxcXCI6bnVsbCxcXFwic21pbGVzVmFsaWRvXFxcIjpcXFwiXFxcIixcXFwidmFsaWRhcl90eXBlXFxcIjpcXFwiXFxcIixcXFwiZGF0YV9jYWRhc3Ryb1xcXCI6ZmFsc2UsXFxcImRlc3Rpbm9fYnVzY2FcXFwiOlxcXCJcXFwiLFxcXCJmYXplckNhZGFzdHJvXFxcIjpudWxsLFxcXCJub21lX2NhZGFzdHJvXFxcIjpmYWxzZSxcXFwic2VhcmNoX2ZsaWdodFxcXCI6XFxcIlxcXCIsXFxcImRlc2NvbnRvX2NsdWJlXFxcIjpcXFwiXFxcIixcXFwiZW1haWxfY2FkYXN0cm9cXFwiOmZhbHNlLFxcXCJwcm9tb1BhcnRpY2lwZVxcXCI6bnVsbCxcXFwic2VudFRvQ2hlY2tvdXRcXFwiOlxcXCJcXFwiLFxcXCJhZGRfdG9fY2hlY2tvdXRcXFwiOlxcXCJcXFwiLFxcXCJnZW5lcm9fY2FkYXN0cm9cXFwiOmZhbHNlLFxcXCJwYXNzZW5nZXJfZW1haWxcXFwiOlxcXCJcXFwiLFxcXCJyZXR1cm5fc2VsZWN0ZWRcXFwiOlxcXCJcXFwiLFxcXCJzZWFyY2hGYXZvcml0ZXNcXFwiOlxcXCJcXFwiLFxcXCJzZWdtZW50U2VsZWN0ZWRcXFwiOm51bGwsXFxcIm11bHRpcGxlX2FpcnBvcnRzXFxcIjpcXFwiXFxcIixcXFwicGFzc2FnZWlyb3NfYmViZXNcXFwiOlxcXCJcXFwiLFxcXCJzZWxlY3RlZF9mYXZvcml0ZVxcXCI6XFxcIlxcXCIsXFxcInRvdGFsX3Bhc3NhZ2Vpcm9zXFxcIjpcXFwiXFxcIixcXFwiZGVwYXJ0dXJlX3NlbGVjdGVkXFxcIjpcXFwiXFxcIixcXFwic29icmVub21lX2NhZGFzdHJvXFxcIjpmYWxzZSxcXFwicGFzc2FnZWlyb3NfYWR1bHRvc1xcXCI6XFxcIlxcXCIsXFxcInBhc3NhZ2Vpcm9zX2NyaWFuY2FzXFxcIjpcXFwiXFxcIixcXFwicmV0dXJuX3NlbGVjdGVkX2ZsaWdodFxcXCI6bnVsbCxcXFwiZGVwYXJ0dXJlX3NlbGVjdGVkX2ZsaWdodFxcXCI6bnVsbH19XCJ9LFwicmVzcG9uc2VGYXVsdFwiOntcImhlYWRlcnNcIjp7XCJ4LXBhZ2UtdXNhZ2VcIjpcIntcXFwiY2FsbF9jb3VudFxcXCI6MSxcXFwidG90YWxfY3B1dGltZVxcXCI6MSxcXFwidG90YWxfdGltZVxcXCI6MX1cIixcImFjY2Vzcy1jb250cm9sLWFsbG93LW9yaWdpblwiOlwiKlwiLFwic3RyaWN0LXRyYW5zcG9ydC1zZWN1cml0eVwiOlwibWF4LWFnZT0xNTU1MjAwMDsgcHJlbG9hZFwiLFwieC1mYi10cmFjZS1pZFwiOlwiRWtPUnQvblNyelRcIixcIngtZmItcmV2XCI6XCIzNTc4MTc1XCIsXCJjb250ZW50LXR5cGVcIjpcImFwcGxpY2F0aW9uL2pzb25cIixcImZhY2Vib29rLWFwaS12ZXJzaW9uXCI6XCJ2Mi4xMFwiLFwiY2FjaGUtY29udHJvbFwiOlwibm8tc3RvcmVcIixcInByYWdtYVwiOlwibm8tY2FjaGVcIixcImV4cGlyZXNcIjpcIlNhdCwgMDEgSmFuIDIwMDAgMDA6MDA6MDAgR01UXCIsXCJ3d3ctYXV0aGVudGljYXRlXCI6XCJPQXV0aCBcXFwiRmFjZWJvb2sgUGxhdGZvcm1cXFwiIFxcXCJpbnZhbGlkX3JlcXVlc3RcXFwiIFxcXCIoIzEwMCkgTm8gbWF0Y2hpbmcgdXNlciBmb3VuZFxcXCJcIixcIngtZmItZGVidWdcIjpcIk9scXhGSGM3UVRWOFRIelJrZ1g4aFFPK0VneGo5bFgvMGx2M0p1VjJFUi8vb2dRSWwxZHlzREJDV1FpNGxnSVNrWUVvdVJTdjdzeU1nQ0d1Ry8rWVFnPT1cIixcImRhdGVcIjpcIldlZCwgMTcgSmFuIDIwMTggMTk6MzY6MjkgR01UXCIsXCJjb25uZWN0aW9uXCI6XCJjbG9zZVwiLFwiY29udGVudC1sZW5ndGhcIjpcIjE0MFwifSxcInN0YXR1c0NvZGVcIjo0MDAsXCJib2R5XCI6e1wiZXJyb3JcIjp7XCJtZXNzYWdlXCI6XCIoIzEwMCkgTm8gbWF0Y2hpbmcgdXNlciBmb3VuZFwiLFwidHlwZVwiOlwiT0F1dGhFeGNlcHRpb25cIixcImNvZGVcIjoxMDAsXCJlcnJvcl9zdWJjb2RlXCI6MjAxODAwMSxcImZidHJhY2VfaWRcIjpcIkVrT1J0L25TcnpUXCJ9fX19In0=",
//                 "approximateArrivalTimestamp": 1516217842.065
//             },
//             "eventSource": "aws:kinesis",
//             "eventVersion": "1.0",
//             "eventID": "shardId-000000000003:49580831982549757066933184131144277635035176746908385330",
//             "eventName": "aws:kinesis:record",
//             "invokeIdentityArn": "arn:aws:iam::774515094505:role/lambda-smiles",
//             "awsRegion": "us-east-1",
//             "eventSourceARN": "arn:aws:kinesis:us-east-1:774515094505:stream/external-logs-to-es"
//         },
//         {
//             "kinesis": {
//                 "kinesisSchemaVersion": "1.0",
//                 "partitionKey": "bluemix-nodered",
//                 "sequenceNumber": "49580831982549757066933184131145486560854809311866519602",
//                 "data": "eyJEYXRhIjoicmVxdWVzdC1tZXRyaWNzLWpzXHR7XCJ1cmlcIjpcIi92Mi42L21lL21lc3NhZ2VzP2FjY2Vzc190b2tlbj1FQUFKekdaQThoMEtJQkFDVUVSeFhtcWs5R2tJRWtGZVF5dFlaQVpBZ0FBMWZaQk1YNmVzOEs5UVJWSG04Um1kTVNBd0t0NUVKSWlUc1FJUmxCRzRqSFRXMXA0VXNMSVNNOTF0OTBCQ3dqdERaQUpjM3JpNVdTc2ZGWkFaQnRUMWZ5TWZzdmYzOUxqMGFqZGk2Z2wwMGxaQWY5blRuNElpNEdxdlAzSTMyTGFDckpBWkRaRFwiLFwiZHVyYXRpb25cIjoyMjIsXCJoYXNFcnJvclwiOnRydWUsXCJyZXF1ZXN0XCI6e1wiaGVhZGVyc1wiOntcImFjY2VwdFwiOlwiYXBwbGljYXRpb24vanNvblwiLFwiY29udGVudC10eXBlXCI6XCJhcHBsaWNhdGlvbi9qc29uXCIsXCJjb250ZW50LWxlbmd0aFwiOjY3fSxcImJvZHlcIjpcIntcXFwicmVjaXBpZW50XFxcIjp7XFxcImlkXFxcIjpcXFwiMzgzODI1Mjg0Mjg4MTk2MFxcXCJ9LFxcXCJzZW5kZXJfYWN0aW9uXFxcIjpcXFwidHlwaW5nX29uXFxcIn1cIn0sXCJyZXNwb25zZUZhdWx0XCI6e1wiaGVhZGVyc1wiOntcIngtcGFnZS11c2FnZVwiOlwie1xcXCJjYWxsX2NvdW50XFxcIjoxLFxcXCJ0b3RhbF9jcHV0aW1lXFxcIjoxLFxcXCJ0b3RhbF90aW1lXFxcIjoxfVwiLFwiYWNjZXNzLWNvbnRyb2wtYWxsb3ctb3JpZ2luXCI6XCIqXCIsXCJzdHJpY3QtdHJhbnNwb3J0LXNlY3VyaXR5XCI6XCJtYXgtYWdlPTE1NTUyMDAwOyBwcmVsb2FkXCIsXCJ4LWZiLXRyYWNlLWlkXCI6XCJGcUJiS25jWXgvNVwiLFwieC1mYi1yZXZcIjpcIjM1NzgxNzVcIixcImNvbnRlbnQtdHlwZVwiOlwiYXBwbGljYXRpb24vanNvblwiLFwiZmFjZWJvb2stYXBpLXZlcnNpb25cIjpcInYyLjEwXCIsXCJjYWNoZS1jb250cm9sXCI6XCJuby1zdG9yZVwiLFwicHJhZ21hXCI6XCJuby1jYWNoZVwiLFwiZXhwaXJlc1wiOlwiU2F0LCAwMSBKYW4gMjAwMCAwMDowMDowMCBHTVRcIixcInd3dy1hdXRoZW50aWNhdGVcIjpcIk9BdXRoIFxcXCJGYWNlYm9vayBQbGF0Zm9ybVxcXCIgXFxcImludmFsaWRfcmVxdWVzdFxcXCIgXFxcIigjMTAwKSBObyBtYXRjaGluZyB1c2VyIGZvdW5kXFxcIlwiLFwieC1mYi1kZWJ1Z1wiOlwic0g0R2M3UmR1SkZaQytnMDdXOWE3WSsvQXlpT01pY0xFTDhaYWNCUEUxUFBIQUJOL05VOU0wUkNGY0c4RE9xVU9FbUJXajIrUUlwRjN4c2xsU3BXY1E9PVwiLFwiZGF0ZVwiOlwiV2VkLCAxNyBKYW4gMjAxOCAxOTozODowOCBHTVRcIixcImNvbm5lY3Rpb25cIjpcImNsb3NlXCIsXCJjb250ZW50LWxlbmd0aFwiOlwiMTQwXCJ9LFwic3RhdHVzQ29kZVwiOjQwMCxcImJvZHlcIjp7XCJlcnJvclwiOntcIm1lc3NhZ2VcIjpcIigjMTAwKSBObyBtYXRjaGluZyB1c2VyIGZvdW5kXCIsXCJ0eXBlXCI6XCJPQXV0aEV4Y2VwdGlvblwiLFwiY29kZVwiOjEwMCxcImVycm9yX3N1YmNvZGVcIjoyMDE4MDAxLFwiZmJ0cmFjZV9pZFwiOlwiRnFCYktuY1l4LzVcIn19fX0ifQ==",
//                 "approximateArrivalTimestamp": 1516218102.463
//             },
//             "eventSource": "aws:kinesis",
//             "eventVersion": "1.0",
//             "eventID": "shardId-000000000003:49580831982549757066933184131145486560854809311866519602",
//             "eventName": "aws:kinesis:record",
//             "invokeIdentityArn": "arn:aws:iam::774515094505:role/lambda-smiles",
//             "awsRegion": "us-east-1",
//             "eventSourceARN": "arn:aws:kinesis:us-east-1:774515094505:stream/external-logs-to-es"
//         },
//         {
//             "kinesis": {
//                 "kinesisSchemaVersion": "1.0",
//                 "partitionKey": "bluemix-nodered",
//                 "sequenceNumber": "49580831982549757066933184131146695486674423941041225778",
//                 "data": "eyJEYXRhIjoicmVxdWVzdC1tZXRyaWNzLWpzXHR7XCJ1cmlcIjpcIi92Mi42L21lL21lc3NhZ2VzP2FjY2Vzc190b2tlbj1FQUFKekdaQThoMEtJQkFDVUVSeFhtcWs5R2tJRWtGZVF5dFlaQVpBZ0FBMWZaQk1YNmVzOEs5UVJWSG04Um1kTVNBd0t0NUVKSWlUc1FJUmxCRzRqSFRXMXA0VXNMSVNNOTF0OTBCQ3dqdERaQUpjM3JpNVdTc2ZGWkFaQnRUMWZ5TWZzdmYzOUxqMGFqZGk2Z2wwMGxaQWY5blRuNElpNEdxdlAzSTMyTGFDckpBWkRaRFwiLFwiZHVyYXRpb25cIjoyMjQsXCJoYXNFcnJvclwiOnRydWUsXCJyZXF1ZXN0XCI6e1wiaGVhZGVyc1wiOntcImFjY2VwdFwiOlwiYXBwbGljYXRpb24vanNvblwiLFwiY29udGVudC10eXBlXCI6XCJhcHBsaWNhdGlvbi9qc29uXCIsXCJjb250ZW50LWxlbmd0aFwiOjI1Mzh9LFwiYm9keVwiOlwie1xcXCJyZWNpcGllbnRcXFwiOntcXFwiaWRcXFwiOlxcXCIzODM4MjUyODQyODgxOTYwXFxcIn0sXFxcIm1lc3NhZ2VcXFwiOntcXFwidGV4dFxcXCI6XFxcIk7Do28gZW50ZW5kaSBvIHF1ZSB2b2PDqiBxdWVyLiBTb2JyZSBvIHF1ZSBkZXNlamEgZmFsYXI/XFxcIixcXFwicXVpY2tfcmVwbGllc1xcXCI6W3tcXFwiY29udGVudF90eXBlXFxcIjpcXFwidGV4dFxcXCIsXFxcInRpdGxlXFxcIjpcXFwiUHJvbW/Dp8O1ZXNcXFwiLFxcXCJwYXlsb2FkXFxcIjpcXFwicXVpY2tfcmVwbHlcXFwifSx7XFxcImNvbnRlbnRfdHlwZVxcXCI6XFxcInRleHRcXFwiLFxcXCJ0aXRsZVxcXCI6XFxcIkJ1c2NhciB2b29cXFwiLFxcXCJwYXlsb2FkXFxcIjpcXFwicXVpY2tfcmVwbHlcXFwifSx7XFxcImNvbnRlbnRfdHlwZVxcXCI6XFxcInRleHRcXFwiLFxcXCJ0aXRsZVxcXCI6XFxcIkNhZGFzdHJhclxcXCIsXFxcInBheWxvYWRcXFwiOlxcXCJxdWlja19yZXBseVxcXCJ9LHtcXFwiY29udGVudF90eXBlXFxcIjpcXFwidGV4dFxcXCIsXFxcInRpdGxlXFxcIjpcXFwiRmFsZSBjb20gU21pbGVzXFxcIixcXFwicGF5bG9hZFxcXCI6XFxcInF1aWNrX3JlcGx5XFxcIn1dfSxcXFwiY29udGV4dFxcXCI6e1xcXCJ0aW1lem9uZVxcXCI6XFxcIkdNVHVuZGVmaW5lZFxcXCIsXFxcImZsaWdodF9jb3VudGVyXFxcIjowLFxcXCJmbGlnaHRCYWNrX2NvdW50ZXJcXFwiOjAsXFxcInNtaWxlc191cmxzXFxcIjp7XFxcInJlY3VwZXJhcl9zZW5oYVxcXCI6XFxcImh0dHBzOi8vZ29vLmdsL3BhSllORVxcXCIsXFxcImNvbXByYXJfbWlsaGFzXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvWm5iWWZUXFxcIixcXFwibWV1c192b29zXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvQXJGSkNyXFxcIixcXFwiYmFnYWdlbnNfZV9hc3NlbnRvc1xcXCI6XFxcImh0dHBzOi8vZ29vLmdsL3Q3RTJWUVxcXCIsXFxcIndlYnNpdGVcXFwiOlxcXCJodHRwczovL2dvby5nbC83a1dESzdcXFwiLFxcXCJjbHViZV9zbWlsZXNcXFwiOlxcXCJodHRwczovL2dvby5nbC9VUjczTXZcXFwiLFxcXCJ0ZXJtb3NfZGVfdmlhZ2VtXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvZjFZdFpHXFxcIixcXFwicGFnaW5hX2xvZ2luXFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvUGRKTkV4XFxcIixcXFwiaGVscFxcXCI6XFxcImh0dHBzOi8vZ29vLmdsL2tkZ2NiN1xcXCIsXFxcImFjY2Vzc19hY2NvdW50XFxcIjpcXFwiaHR0cHM6Ly9nb28uZ2wvSkpFbllYXFxcIn0sXFxcImxpbWl0c0ZvckJvb2tpbmdcXFwiOntcXFwibG93ZXJcXFwiOntcXFwiZGF0ZVxcXCI6XFxcIjIwMTgtMDEtMTdcXFwiLFxcXCJob3VyXFxcIjpcXFwiMDU6MzhcXFwifSxcXFwidXBwZXJcXFwiOntcXFwiZGF0ZVxcXCI6XFxcIjIwMTgtMTItMTNcXFwiLFxcXCJob3VyXFxcIjpcXFwiMDU6MzhcXFwifSxcXFwiY3VycmVudFxcXCI6e1xcXCJkYXRlXFxcIjpcXFwiMjAxOC0wMS0xN1xcXCIsXFxcImhvdXJcXFwiOlxcXCIwNTozOFxcXCJ9fSxcXFwibW9udGhMYXN0RGF0ZVxcXCI6XFxcIjMxLzAxLzIwMThcXFwiLFxcXCJjb252ZXJzYXRpb25faWRcXFwiOlxcXCI0YmI4MDIyNS05M2YzLTRmZDYtOGVlMy02YzU1ZDMyYzVhZDhcXFwiLFxcXCJzeXN0ZW1cXFwiOntcXFwiZGlhbG9nX3N0YWNrXFxcIjpbe1xcXCJkaWFsb2dfbm9kZVxcXCI6XFxcInJvb3RcXFwifV0sXFxcImRpYWxvZ190dXJuX2NvdW50ZXJcXFwiOjYsXFxcImRpYWxvZ19yZXF1ZXN0X2NvdW50ZXJcXFwiOjYsXFxcIl9ub2RlX291dHB1dF9tYXBcXFwiOntcXFwiQmVtLXZpbmRvXFxcIjpbMF0sXFxcIkVtIG91dHJvcyBjYXNvc1xcXCI6WzBdfSxcXFwiYnJhbmNoX2V4aXRlZFxcXCI6dHJ1ZSxcXFwiYnJhbmNoX2V4aXRlZF9yZWFzb25cXFwiOlxcXCJjb21wbGV0ZWRcXFwifSxcXFwidG9cXFwiOlxcXCJcXFwiLFxcXCJ0YXhcXFwiOlxcXCJcXFwiLFxcXCJmcm9tXFxcIjpcXFwiXFxcIixcXFwidGVybVxcXCI6XFxcIlxcXCIsXFxcImF0aXZvXFxcIjpcXFwiXFxcIixcXFwiY2x1YmVcXFwiOlxcXCJcXFwiLFxcXCJvcHRpblxcXCI6ZmFsc2UsXFxcInRpbWVyXFxcIjpcXFwiXFxcIixcXFwidG9kYXlcXFwiOlxcXCJcXFwiLFxcXCJpbnRlbnRcXFwiOlxcXCJcXFwiLFxcXCJtZW1iZXJcXFwiOlxcXCJcXFwiLFxcXCJyZXR1cm5cXFwiOlxcXCJcXFwiLFxcXCJzZWFyY2hcXFwiOlxcXCJcXFwiLFxcXCJvcHRpb25zXFxcIjpbXFxcIlByb21vw6fDtWVzXFxcIixcXFwiQnVzY2FyIHZvb1xcXCIsXFxcIkNhZGFzdHJhclxcXCIsXFxcIkZhbGUgY29tIFNtaWxlc1xcXCJdLFxcXCJzdW1tYXJ5XFxcIjpcXFwiXFxcIixcXFwiYWlycG9ydHNcXFwiOlxcXCJcXFwiLFxcXCJkYXRhX2lkYVxcXCI6XFxcIlxcXCIsXFxcImVsZWdpdmVsXFxcIjpudWxsLFxcXCJyZWdpc3RlclxcXCI6bnVsbCxcXFwiY2hlY2tEYXRlXFxcIjpcXFwiXFxcIixcXFwiY3BmVmFsaWRvXFxcIjpcXFwiXFxcIixcXFwiZGVwYXJ0dXJlXFxcIjpcXFwiXFxcIixcXFwiY2hlY2tFbWFpbFxcXCI6XFxcIlxcXCIsXFxcImNoZWNrX2RhdGVcXFwiOlxcXCJcXFwiLFxcXCJkYXRhX3ZvbHRhXFxcIjpcXFwiXFxcIixcXFwicGFzc2VuZ2Vyc1xcXCI6XFxcIlxcXCIsXFxcInByb21vQ2x1YmVcXFwiOm51bGwsXFxcInZhbGlkYXJDUEZcXFwiOm51bGwsXFxcInJnX2NhZGFzdHJvXFxcIjpmYWxzZSxcXFwic2VhcmNoT3JkZXJcXFwiOlxcXCJcXFwiLFxcXCJ2YWxpZGFyX2NwZlxcXCI6XFxcIlxcXCIsXFxcImNwZl9jYWRhc3Ryb1xcXCI6ZmFsc2UsXFxcImVtYWlsX3ZhbGlkb1xcXCI6XFxcIlxcXCIsXFxcIm9yaWdlbV9idXNjYVxcXCI6XFxcIlxcXCIsXFxcInByb21vRW50ZW5kYVxcXCI6bnVsbCxcXFwic21pbGVzVmFsaWRvXFxcIjpcXFwiXFxcIixcXFwidmFsaWRhcl90eXBlXFxcIjpcXFwiXFxcIixcXFwiZGF0YV9jYWRhc3Ryb1xcXCI6ZmFsc2UsXFxcImRlc3Rpbm9fYnVzY2FcXFwiOlxcXCJcXFwiLFxcXCJmYXplckNhZGFzdHJvXFxcIjpudWxsLFxcXCJub21lX2NhZGFzdHJvXFxcIjpmYWxzZSxcXFwic2VhcmNoX2ZsaWdodFxcXCI6XFxcIlxcXCIsXFxcImRlc2NvbnRvX2NsdWJlXFxcIjpcXFwiXFxcIixcXFwiZW1haWxfY2FkYXN0cm9cXFwiOmZhbHNlLFxcXCJwcm9tb1BhcnRpY2lwZVxcXCI6bnVsbCxcXFwic2VudFRvQ2hlY2tvdXRcXFwiOlxcXCJcXFwiLFxcXCJhZGRfdG9fY2hlY2tvdXRcXFwiOlxcXCJcXFwiLFxcXCJnZW5lcm9fY2FkYXN0cm9cXFwiOmZhbHNlLFxcXCJwYXNzZW5nZXJfZW1haWxcXFwiOlxcXCJcXFwiLFxcXCJyZXR1cm5fc2VsZWN0ZWRcXFwiOlxcXCJcXFwiLFxcXCJzZWFyY2hGYXZvcml0ZXNcXFwiOlxcXCJcXFwiLFxcXCJzZWdtZW50U2VsZWN0ZWRcXFwiOm51bGwsXFxcIm11bHRpcGxlX2FpcnBvcnRzXFxcIjpcXFwiXFxcIixcXFwicGFzc2FnZWlyb3NfYmViZXNcXFwiOlxcXCJcXFwiLFxcXCJzZWxlY3RlZF9mYXZvcml0ZVxcXCI6XFxcIlxcXCIsXFxcInRvdGFsX3Bhc3NhZ2Vpcm9zXFxcIjpcXFwiXFxcIixcXFwiZGVwYXJ0dXJlX3NlbGVjdGVkXFxcIjpcXFwiXFxcIixcXFwic29icmVub21lX2NhZGFzdHJvXFxcIjpmYWxzZSxcXFwicGFzc2FnZWlyb3NfYWR1bHRvc1xcXCI6XFxcIlxcXCIsXFxcInBhc3NhZ2Vpcm9zX2NyaWFuY2FzXFxcIjpcXFwiXFxcIixcXFwicmV0dXJuX3NlbGVjdGVkX2ZsaWdodFxcXCI6bnVsbCxcXFwiZGVwYXJ0dXJlX3NlbGVjdGVkX2ZsaWdodFxcXCI6bnVsbH19XCJ9LFwicmVzcG9uc2VGYXVsdFwiOntcImhlYWRlcnNcIjp7XCJ4LXBhZ2UtdXNhZ2VcIjpcIntcXFwiY2FsbF9jb3VudFxcXCI6MSxcXFwidG90YWxfY3B1dGltZVxcXCI6MSxcXFwidG90YWxfdGltZVxcXCI6MX1cIixcImFjY2Vzcy1jb250cm9sLWFsbG93LW9yaWdpblwiOlwiKlwiLFwic3RyaWN0LXRyYW5zcG9ydC1zZWN1cml0eVwiOlwibWF4LWFnZT0xNTU1MjAwMDsgcHJlbG9hZFwiLFwieC1mYi10cmFjZS1pZFwiOlwiQmhKRmRhNTgwSXpcIixcIngtZmItcmV2XCI6XCIzNTc4MTc1XCIsXCJjb250ZW50LXR5cGVcIjpcImFwcGxpY2F0aW9uL2pzb25cIixcImZhY2Vib29rLWFwaS12ZXJzaW9uXCI6XCJ2Mi4xMFwiLFwiY2FjaGUtY29udHJvbFwiOlwibm8tc3RvcmVcIixcInByYWdtYVwiOlwibm8tY2FjaGVcIixcImV4cGlyZXNcIjpcIlNhdCwgMDEgSmFuIDIwMDAgMDA6MDA6MDAgR01UXCIsXCJ3d3ctYXV0aGVudGljYXRlXCI6XCJPQXV0aCBcXFwiRmFjZWJvb2sgUGxhdGZvcm1cXFwiIFxcXCJpbnZhbGlkX3JlcXVlc3RcXFwiIFxcXCIoIzEwMCkgTm8gbWF0Y2hpbmcgdXNlciBmb3VuZFxcXCJcIixcIngtZmItZGVidWdcIjpcImlYKzlHc24zTDdMNk5qblJhQk15NG44WEFrR0xWLzlyUEJHOVgvTnhZZVFhVW5aRmw1SytWTVJPSy8rTE9VRUkxOFhqbTFEaDQvTFFCMDNZOEtUaW5nPT1cIixcImRhdGVcIjpcIldlZCwgMTcgSmFuIDIwMTggMTk6Mzg6MTYgR01UXCIsXCJjb25uZWN0aW9uXCI6XCJjbG9zZVwiLFwiY29udGVudC1sZW5ndGhcIjpcIjEzOVwifSxcInN0YXR1c0NvZGVcIjo0MDAsXCJib2R5XCI6e1wiZXJyb3JcIjp7XCJtZXNzYWdlXCI6XCIoIzEwMCkgTm8gbWF0Y2hpbmcgdXNlciBmb3VuZFwiLFwidHlwZVwiOlwiT0F1dGhFeGNlcHRpb25cIixcImNvZGVcIjoxMDAsXCJlcnJvcl9zdWJjb2RlXCI6MjAxODAwMSxcImZidHJhY2VfaWRcIjpcIkJoSkZkYTU4MEl6XCJ9fX19In0=",
//                 "approximateArrivalTimestamp": 1516218102.466
//             },
//             "eventSource": "aws:kinesis",
//             "eventVersion": "1.0",
//             "eventID": "shardId-000000000003:49580831982549757066933184131146695486674423941041225778",
//             "eventName": "aws:kinesis:record",
//             "invokeIdentityArn": "arn:aws:iam::774515094505:role/lambda-smiles",
//             "awsRegion": "us-east-1",
//             "eventSourceARN": "arn:aws:kinesis:us-east-1:774515094505:stream/external-logs-to-es"
//         }
//     ]
// })
